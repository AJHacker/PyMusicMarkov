##Algorithmic Help and Muic Theory Help and Code Help Credited to
##David Yang-dzy
##
##

import numpy,math,random,copy
from scipy.io.wavfile import write
from xmlParser import Parse,testLengths
from numpy import linspace,sin,pi,int16

notes={
    'c':32.7032,
    'dbb':32.7032,
    'c#':34.6478,
    'db':34.6478,
    'c##':36.7081,
    'd':36.7081,
    'ebb':36.7081,
    'd#':38.8909,
    'eb':38.8909,
    'd##':41.2034,
    'e':41.2034,
    'e#':43.6535,
    'fb':41.2034,
    'e##':43.6535,
    'f':43.6535,
    'gbb':43.6535,
    'f#':46.2493,
    'gb':46.2493,
    'f##':48.9994,
    'g':48.9994,
    'abb':48.9994,
    'g#':51.9131,
    'ab':51.9131,
    'g##':55.0,
    'a':55.0,
    'bbb':55.0,
    'a#':58.2705,
    'bb':58.2705,
    'a##':61.7354,
    'b':61.7354,
    'b#':32.7032,
    'cb':61.73542/2,
    'r':0,
    'p':10,
   }

def memoized(f):
    # You are not responsible for how this decorator works
    # on the inside, just how to use it!
    import functools
    cachedResults = dict()
    @functools.wraps(f)
    def wrapper(*args):
        if args not in cachedResults:
            cachedResults[args] = f(*args)
        return cachedResults[args]
    return wrapper

@memoized
def make_wave(freq=440, time=1, amp=100, phase=0, samplerate=44100, bitspersample=16):
    bytelist = []
    k=2
    TwoPiDivSamplerate = 2*math.pi/samplerate
    if freq==10:
        (freq,k)=(70,8)
    # if freq<71:
    #     amp=135
    # elif freq<120:
    #     amp=120
    # elif freq<110:
    #     amp=110
    amp/=100
    increment = TwoPiDivSamplerate * freq
    incadd = phase*increment
    for i in range(int(samplerate*time)):
        if incadd > (2**(bitspersample - 1) - 1):
            incadd = (2**(bitspersample - 1) - 1) - (incadd - (2**(bitspersample - 1) - 1))
        elif incadd < -(2**(bitspersample - 1) - 1):
            incadd = -(2**(bitspersample - 1) - 1) + (-(2**(bitspersample - 1) - 1) - incadd)
        #organ=(math.sin(incadd)+.3162*math.sin(2*incadd)+.15*math.sin(3*incadd)+.3162*math.sin(4*incadd)+.12*math.sin(5*incadd)+.3*math.sin(6*incadd)+.08*math.sin(7*incadd)+.15*math.sin(8*incadd)+.05*math.sin(9*incadd)+.01*math.sin(10*incadd))
        #whoop=math.e**(-((i-int(samplerate*time)/2)**2)/(2*(int(samplerate*time)/4)**2))*math.sin(incadd)
        #cello=math.sin(incadd)+.53*math.sin(2*incadd)+.375*math.sin(3*incadd)+.5*math.sin(4*incadd)+.375*math.sin(5*incadd)+.25*math.sin(6*incadd)+.23*math.sin(7*incadd)+.125*math.sin(8*incadd)+.16*math.sin(9*incadd)+.125*math.sin(10*incadd)+.125*math.sin(11*incadd)
        # x=cello
        # f=freq
        # if f!=0:
        #     while f<=10*freq:
        #         a=random.randint(1,5)/100
        #         x+=a*math.sin((f/freq)*incadd)
        #         f+=freq/10
        default=math.sin(incadd)
        bytelist.append(amp*int(round(math.e**(-(k*i)/(samplerate*time))*(2**(bitspersample - 1) - 1)*default)))
        incadd += increment
    return bytelist

# def make_wave(freq=440,time=1,amp=100,rate=44100):
#     t=linspace(0,time,time*rate)
#     data=sin(2*pi*freq*t)*amp

#     #instrument1=numpy.power(data,math.e**(-2*data/(time*rate)))

#     #instrument2
#     # def instrument2(x):
#     #     return math.e**((-2*x)/(rate*time))
#     # instrument2=numpy.vectorize(instrument2)


#     def f(x):
#         return math.e**((-5*x))*math.sin(2*pi*freq*x)*amp
#     f=numpy.vectorize(f)
#     data=f(t)
#     #data=instrument2(data)
#     return numpy.ndarray.tolist(data.astype(int16))

tempo=105 #bpm
tempo0=105

amp0=100.0
amp=100

def noteToNum(s):
    global lastOctave
    beatLen=1/(int(tempo)/60)
    l=s.split()
    freq=notes[l[0]]
    # if len(l)<3:
    #     octave=lastOctave
    # else:
    octave=int(l[1])-1
    #lastOctave=octave
    value=float(l[-1])
    if len(l)<4:
        a=amp
    else:
        a=int(l[3])
    nums=(freq*2**octave,value*beatLen,a)
    return nums

last=None
last2=None

def removeOutliers(L):
    if len(L)>2:
        lengths=list(map(len,L))
        lens=copy.deepcopy(lengths)
        med=median(lens)
        for voice in L:
            if abs(len(voice)-med)>med*.005:
                removearray(L,voice)
        return L
    else:
        return L

def removearray(L,arr):
    ind = 0
    size = len(L)
    while ind != size and not numpy.array_equal(L[ind],arr):
        ind += 1
    if ind != size:
        L.pop(ind)
    else:
        raise ValueError('array not found in list.')

def median(L):
    while len(L)>2:
        L.remove(max(L))
        L.remove(min(L))
    return L[0]

def songToWave(song):
    result=[]
    voices=[]
    global last,last2,tempo,amp
    for voice in song:
        tempo=tempo0
        amp=amp0
        print('v',voice)
        voiceWave=[]
        for chord in voice:
            print('c',chord)
            chordWave=[]
            if isinstance(chord,int):
                tempo=tempoScale*chord
                continue
            elif isinstance(chord,float):
                amp=chord
                continue
            elif isinstance(chord,str):
                (f,t,a)=noteToNum(chord)
                chordWave=numpy.array(make_wave(f,t,a))
            else:
                for note in chord:
                    (f,t,a)=noteToNum(note)
                    tone=numpy.array(make_wave(f,t,a))
                    if chordWave==[]:
                        chordWave=tone
                    else:
                        # chordWave+=tone
                        try:
                            chordWave+=tone[:len(chordWave)]
                        except:
                            chordWave=chordWave[:len(tone)]
                            chordWave+=tone
                            print('cut broken tie')

            chordWave=numpy.ndarray.tolist(chordWave)
            last2=last
            last=chordWave
            voiceWave+=chordWave
        print(len(voiceWave))
        finalVoice=numpy.array(voiceWave)
        voices.append(finalVoice)

    voices=removeOutliers(voices)
    lengths=list(map(len,voices))
    med=median(lengths)
    for voice in voices:
        if len(voice)>=med:
            voice=voice[:med]
        else:
            voice=numpy.append(voice,[0]*(med-len(voice)))
        if result==[]:
            result=voice
        else:
            result+=voice
    return numpy.ndarray.tolist(result)

# to add note
# data+=make_wave(freq,time)
def play(path,name,inTempo=None,tiesOn=True):
    #testLengths(name+'.xml',inTempo,tiesOn)
    (song,tempo)=Parse(path,inTempo,tiesOn)
    global tempo0
    tempo0=tempoScale*tempo
    song=songToWave(song)
    scaled = numpy.int16(song/numpy.max(numpy.abs(song)) * 32767)
    print(scaled)
    try:
        write('%s.wav'%name, 44100, scaled)
    except:
        print('fuck')
        write('%salt.wav'%name, 44100, scaled)

def playMarkov(filename,song,tempo):
    global tempo0
    name = filename
    tempo0=tempoScale*tempo
    song=songToWave(song)
    scaled = numpy.int16(song/numpy.max(numpy.abs(song)) * 32767)
    print(scaled)
    try:
        write('WAV/%s.wav'%name, 44100, scaled)
    except:
        print('fuck')
        write('WAV/%salt.wav'%name, 44100, scaled)
    return True
tempoScale=1

#test = ([['c 4 0.25', 'r 4 0.25', 'a 2 0.25', 'c 3 0.5', 'd 3 1.0', 'd 4 1.0', 'c 3 0.5', 'd 3 1.0', 'd 3 1.0', 'd 3 1.0', 'r 4 1.0', 'r 4 1.0', 'r 4 0.5', 'c 3 0.5', 'd 3 1.0', 'r 4 1.0', 'r 4 1.0', 'r 4 1.0', 'd 3 1.0', 'r 4 1.0', 'd 3 1.0', 'd 4 1.0', 'c 3 1.0', 'r 4 2.0', 'r 4 0.5', 'd 3 0.5', 'g 3 0.5', 'd 4 0.5', 'd 4 0.5', 'd 4 0.5', 'd 4 0.25', 'c 4 0.25', 'r 4 0.25', 'd 4 0.25', 'd 4 0.25', 'd 4 0.25', 'd 4 0.25', 'd 4 0.25', 'c 4 0.25', 'r 4 0.25', 'f 3 0.25', 'r 4 0.25', 'g 3 0.25', 'b 3 0.25', 'f 3 0.25', 'r 4 0.25', 'g 3 0.25', 'b 3 0.25', 'f 3 0.25', 'r 4 0.5', 'c 3 0.5', 'c# 3 0.25', 'd 3 0.25', 'r 4 0.5', 'd 4 0.5', 'd 4 0.25', 'd 4 0.25', 'd 4 0.25', 'd 4 0.25', 'r 4 0.25', 'd 4 0.25', 'r 4 0.25', 'g 3 0.25', 'b 3 0.25', 'f 3 0.25', 'r 4 0.5', 'd 3 0.5', 'g 3 0.75', 'f 3 0.25', 'r 4 0.5', 'd 3 0.5', 'g 3 0.75', 'a 3 0.5', 'c 4 0.5', 'd 4 0.5', 'd 4 0.5', 'd 4 0.5', 'r 4 2.0', 'r 4 0.5', 'c 3 0.5', 'd 3 1.0', 'r 4 1.0', 'r 4 0.5', 'd 3 0.5', 'd 3 0.5', 'd 3 0.5', 'c 3 1.0', 'r 4 1.0', 'r 4 1.0'], ['f 2 1.0', 'd 2 1.0', 'd 3 1.0', 'r 4 1.5', 'd 2 0.5', 'c 2 1.0', 'c# 2 1.0', 'c 2 1.0', 'r 4 2.0', 'r 4 0.5', 'd 2 0.5', 'g 2 0.75', 'f 2 0.25', 'r 4 0.5', 'c 2 0.5', 'c# 2 0.25', 'd 2 0.25', 'r 4 0.5', 'd 2 0.5', 'g 2 0.75', 'f 2 0.25', 'r 4 0.5', 'd 2 0.5', 'd 2 0.5', 'g 2 0.75', 'f 2 0.25', 'r 4 0.5', 'c 2 0.5', 'd 2 1.0', 'd 2 1.0', 'r 4 1.0', 'r 4 0.5', 'c 2 0.5', 'd 2 1.0', 'd 2 1.0', 'r 4 1.0', 'r 4 0.5', 'c 2 0.5', 'd 2 1.0', 'd 2 1.0', 'd 2 1.0', 'd 2 1.0', 'd 2 1.0', 'r 4 1.0', 'r 4 0.5', 'd 2 0.5', ('d 2 1.0', 'd 3 1.0'), ('d 2 1.0', 'd 3 1.0'), ('d 2 1.0', 'd 3 1.0'), 'r 4 1.0', 'r 4 1.0', 'r 4 0.5', 'd 2 0.5', 'g 2 0.75', 'f 2 0.25', 'r 4 0.25', 'd 3 0.25', 'd 3 0.25', 'd 3 0.25', 'r 4 0.25', 'g 2 0.25', 'b 2 0.25', 'f 2 0.25', 'r 4 0.5', 'd 2 0.5', ('d 2 1.0', 'd 3 1.0'), ('d 2 1.0', 'd 3 1.0'), 'r 4 1.0', 'r 4 1.0', 'd 2 1.0', 'f 2 0.75', 'g 2 0.75', 'f 2 0.25', 'r 4 0.5', 'c 2 0.5', 'd 2 1.0', 'r 4 1.0', 'r 4 0.5', 'c 2 0.25', 'd 2 0.25', 'f 2 1.0', 'f# 2 1.0', 'g 2 1.0', 'g# 2 1.0', 'a 2 1.0', 'bb 2 1.0', 'b 2 1.0', 'c 3 1.0', 'c# 3 0.5'], ['d 5 1.5', 'r 4 0.5', ('b 3 0.5', 'f 4 0.5'), 'r 4 0.5', ('c 5 0.5', 'f 5 0.5'), 'r 4 1.0', ('c 4 0.25', 'c 5 0.25'), ('f 4 0.5', 'f 5 0.5'), ('f 4 1.0', 'f 5 1.0'), 'r 4 0.5', 'r 4 0.25', ('c 5 0.25', 'f 5 0.25'), ('c 5 0.25', 'f 5 0.25'), 'r 4 0.5', ('c 4 0.25', 'c 5 0.25'), ('d 4 0.75', 'd 5 0.75'), ('c 4 0.25', 'c 5 0.25'), ('c 4 0.25', 'c 5 0.25'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.25', 'c 5 0.25'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.25', 'c 5 0.25'), ('a 3 0.25', 'a 4 0.25'), 'r 4 0.5', 'g 4 0.5', 'f 4 0.25', 'f 4 0.25', 'f 4 0.25', 'f 4 0.5', 'f 4 0.5', 'f 4 0.25', 'r 4 1.0', 'p 1 1.0', 'r 4 1.0', ('c 4 0.75', 'f 4 0.75'), ('c 4 0.25', 'f 4 0.25'), 'r 4 1.0', 'f 4 0.25', 'g 4 0.5', 'f 4 0.25', 'r 4 0.75', 'f 4 0.25', 'f 4 0.25', 'a 4 0.5', 'c 5 0.5', 'd 5 0.5', 'd 4 1.0', 'r 4 0.5', ('b 4 0.75', 'f 5 0.75'), ('b 4 0.25', 'f 5 0.25'), 'r 4 1.0', 'f 4 0.25', 'r 4 1.0', ('c 4 0.75', 'f 4 0.75'), ('c 4 0.25', 'f 4 0.25'), 'r 4 2.0', 'r 4 0.5', 'f 4 0.5', 'c 4 0.25', 'c 4 0.5', 'd 4 0.75', 'd 4 0.75', 'd 4 0.75', 'd 4 0.75', 'c 4 0.5', 'c 4 0.25', 'c 4 0.25', 'c 4 0.5', 'c 4 0.25', 'c 4 0.25', 'd 4 0.5', 'd 5 0.75', 'f 4 0.25', 'f 4 0.25', 'f 4 0.25', 'f 4 0.5', 'f 4 0.5', 'f 4 0.5', 'f 4 0.25', 'f 4 0.5', 'f 4 0.5', 'c 4 0.25', 'd 4 0.5', 'd 4 0.5', 'd 4 0.25', 'd 4 0.75', 'r 4 0.5'], ['c 4 0.25', 'r 4 0.25', 'g 3 0.25', 'b 3 0.25', 'f 3 0.25', 'r 4 0.5', 'd 3 0.5', 'g 3 0.75', 'f 3 0.25', 'r 4 0.5', 'c 3 0.5', 'd 3 1.0', 'r 4 1.0', 'd 3 1.0', 'r 4 1.0', 'r 4 0.5', 'd 3 0.5', 'g 3 0.75', 'f 3 0.25', 'r 4 0.5', 'd 3 1.0', 'd 3 1.5', 'd# 3 1.0', 'e 3 1.0', 'f 3 1.0', 'd 3 0.5', 'g 3 0.75', 'f 3 0.25', 'r 4 0.5', 'd 3 0.5', 'g 3 0.75', 'f 3 0.25', 'r 4 0.5', 'd 3 1.0', 'r 4 1.0', 'r 4 1.0', 'r 4 1.0', 'r 4 0.5', 'd 4 0.5', 'd 4 0.5', 'd 4 0.5', 'r 4 2.0', 'd 3 1.0', 'd 4 1.0', 'r 4 1.0', 'r 4 1.0', 'r 4 1.0', 'r 4 0.5', 'd 4 0.5', 'd 4 0.5', 'r 4 2.0', 'd 3 1.0', 'd 4 1.0', 'r 4 1.5', 'd 3 0.5', 'a 3 0.75', 'f 4 0.75', 'd 4 0.5', 'd 4 0.5', 'r 4 2.0', 'd 3 1.0', 'd 3 1.5', 'd# 3 1.0', 'e 3 1.0', 'f 3 1.0', 'd 3 1.0', 'd 3 1.5', 'd# 3 1.0', 'e 3 1.0', 'f 3 1.0', 'f# 3 1.0', 'g 3 1.0', 'g# 3 1.0', 'a 3 1.0', 'bb 3 1.0', 'bb 3 1.0', 'b 3 1.0', 'c 4 1.0', 'c# 4 0.5', 'r 4 0.5', 'c 3 0.5', 'd 3 1.0', 'd 4 1.0', 'r 4 1.0', 'r 4 1.0', 'r 4 0.5', 'd 3 0.5', 'g 3 0.75', 'f 3 0.25'], ['g 4 0.5', 'f 4 0.25', 'r 4 2.0', 'c 4 1.0', 'c# 4 1.0', 'c 4 0.75', 'c 4 0.5', 'c 4 0.25', 'c 4 0.25', 'd 4 0.25', 'c 4 0.25', 'c 4 0.25', 'c 4 0.25', 'd 4 0.25', 'r 4 0.5', ('b 3 0.5', 'f 4 0.5'), ('b 3 1.0', 'f 4 1.0'), ('c 4 0.75', 'f 4 0.75'), ('c 4 0.25', 'f 4 0.25'), 'r 4 0.5', ('c 4 0.5', 'c 5 0.5'), ('c 4 0.25', 'c 5 0.25'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.25', 'c 5 0.25'), ('d 4 0.75', 'd 5 0.75'), 'r 4 2.0', 'c 4 1.0', 'c# 4 1.0', 'c 4 0.75', 'c 4 0.5', 'c 4 0.25', 'd 4 0.25', 'r 4 0.5', ('b 3 0.5', 'f 4 0.5'), ('b 3 1.0', 'f 4 1.0'), ('c 4 0.75', 'f 4 0.75'), ('c 4 0.25', 'f 4 0.25'), 'r 4 0.25', ('c 4 0.25', 'a 4 0.25'), 'r 4 0.25', ('c 4 0.25', 'a 4 0.25'), 'r 4 0.25', ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), 'r 4 0.5', 'r 4 0.5', 'r 4 0.5', 'g 4 0.5', 'f 4 0.25', 'f 4 0.5', 'f 4 0.5', 'f 4 0.5', 'f 4 0.5', 'f 4 0.25', 'f 4 0.25', 'r 4 1.0', 'f 4 0.25', 'r 4 1.0', ('c 4 0.75', 'f 4 0.75'), ('c 4 0.25', 'f 4 0.25'), 'r 4 1.0', 'f 4 0.5', 'f 4 0.25', 'f 4 0.25', 'r 4 1.0', 'r 4 1.0', 'r 4 1.0', 'r 4 1.0', 'f 4 0.25', 'f 4 0.25', 'f 4 0.25', 'f 4 0.5', 'f 4 0.5', 'f 4 0.5', 'f 4 0.25', 'f 4 0.25', 'r 4 1.0', ('c 4 0.75', 'f 4 0.75'), ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), 'r 4 0.25', ('c 4 0.25', 'a 4 0.25'), 'r 4 0.25', ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), 'r 4 1.0'], [('c 5 0.25', 'c 6 0.25'), 'r 4 0.25', ('c 5 0.25', 'f 5 0.25'), ('c 5 0.25', 'f 5 0.25'), 'r 4 2.0', 'r 4 0.5', ('c 5 0.25', 'f 5 0.25'), ('c 5 0.25', 'f 5 0.25'), ('c 5 0.25', 'f 5 0.25'), 'r 4 0.5', ('c 4 0.25', 'c 5 0.25'), ('c 4 0.25', 'c 5 0.25'), ('c 4 0.5', 'c 5 0.5'), ('c# 4 0.5', 'c# 5 0.5'), ('d 4 0.5', 'd 5 0.5'), ('f 4 0.75', 'f 5 0.75'), ('f 4 0.75', 'f 5 0.75'), ('f 4 0.75', 'f 5 0.75'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('d 4 0.25', 'd 5 0.25'), ('d 4 0.5', 'd 5 0.5'), ('d 4 0.25', 'd 5 0.25'), ('d 4 0.25', 'd 5 0.25'), ('d 4 0.25', 'd 5 0.25'), ('d 4 0.25', 'd 5 0.25'), ('d 4 0.5', 'd 5 0.5'), ('d 4 0.25', 'd 5 0.25'), ('d 4 0.5', 'd 5 0.5'), ('d 4 0.25', 'd 5 0.25'), ('d 4 0.75', 'd 5 0.75'), ('c 4 0.25', 'c 5 0.25'), ('d 4 0.75', 'd 5 0.75'), ('d 4 0.25', 'd 5 0.25'), 'r 4 0.5', 'f 5 0.75', 'f 5 0.5', 'c 5 0.25', 'r 4 1.0', 'p 1 1.0', 'r 4 1.0', 'p 1 1.0', 'r 4 2.0', 'r 4 0.5', ('c 4 0.75', 'c 5 0.75'), ('c 4 0.25', 'c 5 0.25'), ('d 4 0.5', 'd 5 0.5'), ('d 4 0.25', 'd 5 0.25'), ('d 4 0.25', 'd 5 0.25'), ('d 4 0.5', 'd 5 0.5'), ('d 4 0.25', 'd 5 0.25'), ('d 4 0.5', 'd 5 0.5'), ('d 4 0.5', 'd 5 0.5'), ('c 4 0.25', 'c 5 0.25'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.25', 'c 5 0.25'), ('c 4 0.25', 'c 5 0.25'), ('c 4 0.25', 'c 5 0.25'), ('c 4 0.25', 'c 5 0.25'), ('f 4 0.5', 'f 5 0.5'), ('f# 4 0.5', 'f# 5 0.5'), ('g 4 0.5', 'g 5 0.5'), ('g# 4 0.5', 'g# 5 0.5'), ('g# 4 0.5', 'g# 5 0.5'), ('g# 4 0.5', 'g# 5 0.5'), ('a 4 0.5', 'a 5 0.5'), ('bb 4 0.5', 'bb 5 0.5'), ('b 4 0.5', 'b 5 0.5'), ('c 5 0.5', 'c 6 0.5'), ('c# 5 0.5', 'c# 6 0.5'), 'r 4 0.5', ('d 5 0.25', 'd 6 0.25'), ('c 5 0.25', 'c 6 0.25'), 'r 4 0.25', ('f 4 0.25', 'f 5 0.25'), ('f 4 0.5', 'f 5 0.5'), ('f 4 0.25', 'f 5 0.25'), ('f 4 0.5', 'f 5 0.5'), ('f 4 1.0', 'f 5 1.0'), 'r 4 0.5', ('d 4 0.5', 'd 5 0.5'), ('c 4 0.25', 'c 5 0.25'), ('d 4 0.5', 'd 5 0.5'), ('f 4 0.75', 'f 5 0.75'), ('c 4 0.5', 'c 5 0.5'), ('c# 4 0.5', 'c# 5 0.5'), ('d 4 0.5', 'd 5 0.5')], [('c 5 0.25', 'c 6 0.25'), 'r 4 1.0', 'p 1 1.0', 'r 4 1.0', ('c 5 0.25', 'c 6 0.25'), ('c 5 0.25', 'c 6 0.25'), ('c 5 0.75', 'c 6 0.75'), ('c 5 0.25', 'c 6 0.25'), 'r 4 0.25', ('f 4 0.25', 'f 5 0.25'), 'r 4 0.25', ('c 6 0.25', 'f 6 0.25'), ('c 6 0.25', 'f 6 0.25'), 'r 4 0.25', ('c 6 0.25', 'f 6 0.25'), 'r 4 0.25', ('c 6 0.25', 'f 6 0.25'), 'r 4 0.25', ('f 4 0.25', 'f 5 0.25'), 'r 4 0.25', ('c 6 0.25', 'f 6 0.25'), ('c 6 0.25', 'f 6 0.25'), 'r 4 0.25', ('f 4 0.25', 'f 5 0.25'), 'r 4 0.25', ('g 4 0.25', 'g 5 0.25'), ('b 4 1.0', 'b 5 1.0'), 'r 4 1.0', 'p 1 1.0', 'r 4 1.0', 'd 6 1.0', 'r 4 2.0', 'r 4 0.5', ('c 5 0.25', 'c 6 0.25'), ('c 5 0.25', 'c 6 0.25'), ('c 5 0.5', 'c 6 0.5'), ('d 5 0.75', 'd 6 0.75'), ('c 5 0.25', 'c 6 0.25'), ('f 5 0.5', 'f 6 0.5'), ('f 5 0.25', 'f 6 0.25'), ('f 5 0.5', 'f 6 0.5'), ('f 5 0.25', 'f 6 0.25'), ('f 5 0.5', 'f 6 0.5'), ('f 5 0.25', 'f 6 0.25'), ('f 5 0.5', 'f 6 0.5'), ('f 5 0.25', 'f 6 0.25'), ('f 5 0.5', 'f 6 0.5'), ('d 5 0.5', 'd 6 0.5'), ('d 5 0.25', 'd 6 0.25'), ('d 5 0.5', 'd 6 0.5'), ('d 5 0.25', 'd 6 0.25'), ('d 5 0.75', 'd 6 0.75'), ('d 5 0.75', 'd 6 0.75'), ('c 5 0.5', 'c 6 0.5'), ('d 5 0.5', 'd 6 0.5'), ('d 5 0.25', 'd 6 0.25'), ('c 5 0.25', 'c 6 0.25'), ('c 5 0.5', 'c 6 0.5'), ('c 5 0.5', 'c 6 0.5'), ('c 5 0.5', 'c 6 0.5'), ('c 5 0.25', 'c 6 0.25'), ('c 5 0.25', 'c 6 0.25'), ('c 5 0.5', 'c 6 0.5'), ('c 5 0.25', 'c 6 0.25'), ('f 5 0.5', 'f 6 0.5'), ('c 5 0.25', 'c 6 0.25'), ('c 5 0.25', 'c 6 0.25'), ('c 5 0.5', 'c 6 0.5'), ('d 5 0.75', 'd 6 0.75'), ('d 5 0.75', 'd 6 0.75'), ('c 5 0.5', 'c 6 0.5'), ('d 5 0.75', 'd 6 0.75'), ('d 5 0.75', 'd 6 0.75'), ('d 5 0.75', 'd 6 0.75'), ('c 5 0.5', 'c 6 0.5'), ('c 5 0.5', 'c 6 0.5'), ('f 5 0.5', 'f 6 0.5'), ('d 5 0.5', 'd 6 0.5'), ('c 5 0.25', 'c 6 0.25'), ('f 5 0.5', 'f 6 0.5'), ('f 5 0.5', 'f 6 0.5'), ('f 5 0.25', 'f 6 0.25'), ('f 5 0.5', 'f 6 0.5'), ('f 5 1.0', 'f 6 1.0'), 'r 4 0.5', ('c 6 0.5', 'f 6 0.5'), 'r 4 1.0', 'p 1 1.0', 'r 4 1.0'], [('c 5 0.25', 'c 6 0.25'), ('c 5 0.25', 'c 6 0.25'), ('c 5 0.5', 'c 6 0.5'), ('d 5 0.25', 'd 6 0.25'), ('d 5 0.25', 'd 6 0.25'), ('d 5 0.25', 'd 6 0.25'), 'r 4 0.5', ('b 4 0.5', 'f 5 0.5'), ('b 4 1.0', 'f 5 1.0'), ('c 5 0.75', 'f 5 0.75'), ('c 5 0.25', 'f 5 0.25'), ('c 5 0.25', 'f 5 0.25'), 'r 4 0.5', 'r 4 0.25', ('a 4 0.25', 'c 5 0.25'), 'r 4 0.25', 'f 4 0.25', 'f 4 0.5', 'f 4 0.5', 'f 4 0.5', 'f 4 0.5', 'f 4 0.5', 'f 4 0.5', 'f 4 0.5', 'f 4 0.5', 'f 4 0.5', 'f 4 0.25', 'f 4 0.5', 'f 4 0.25', 'f 4 0.25', 'f 4 0.25', 'f 4 0.25', 'f 4 0.5', 'f 4 0.5', 'g 4 0.25', 'f 4 0.75', 'r 4 1.0', 'f 4 0.25', 'f 4 0.5', 'f 4 0.5', 'f 4 0.25', 'r 4 0.5', 'f 4 0.5', 'r 4 0.5', ('b 4 0.5', 'f 5 0.5'), ('b 4 1.0', 'f 5 1.0'), ('c 5 0.75', 'f 5 0.75'), ('c 5 0.25', 'f 5 0.25'), ('c 5 0.25', 'f 5 0.25'), 'r 4 0.5', 'r 4 0.5', 'r 4 0.25', 'f 4 0.25', 'f 4 0.5', 'r 4 0.5', 'r 4 0.25', ('c 5 0.25', 'f 5 0.25'), 'r 4 0.25', ('a 4 0.25', 'c 5 0.25'), 'r 4 0.25', ('c 5 0.25', 'f 5 0.25'), 'r 4 1.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 0.5', ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('c 4 0.5', 'c 5 0.5'), ('a 4 1.0', 'f 5 1.0')], ['f 3 0.5', 'd 3 1.0', 'd 4 1.0', 'r 4 0.5', 'c 3 0.5', 'd 3 1.0', 'd 4 1.0', 'd 4 1.0', 'd 4 1.0', 'r 4 1.0', 'r 4 0.5', 'd 3 0.5', 'g 3 0.75', 'f 3 0.25', 'r 4 0.5', 'c 3 0.5', 'd 3 1.0', 'r 4 1.0', 'r 4 0.5', 'd 3 0.5', 'g 3 0.75', 'f 3 0.25', 'r 4 0.5', 'c 3 0.5', 'd 3 1.0', 'r 4 1.0', 'r 4 1.0', 'r 4 0.5', 'c 3 0.5', 'd 3 1.0', 'r 4 1.0', 'r 4 0.5', 'f 3 0.5', 'd 3 1.0', 'd 4 1.0', 'r 4 0.5', 'c 3 0.5', 'd 3 1.0', 'd 4 1.0', 'd 4 1.0', 'd 4 1.0', 'd 4 1.0', 'd 4 1.0', 'd 4 1.0', 'r 4 1.5', 'd 3 0.5', 'g 3 0.75', 'f 3 0.25', 'r 4 0.5', 'd 3 0.5', 'g 3 0.75', 'f 3 0.25', 'r 4 0.5', 'd 4 0.5', 'd 4 0.5', 'd 3 1.0', 'r 4 1.0', 'r 4 0.5', 'c 3 0.5', 'c 3 1.0', 'r 4 2.0', 'r 4 0.5', 'd 3 0.5', 'g 3 0.75', 'f 3 0.25', 'r 4 0.5', 'd 3 0.5', 'g 3 0.75', 'f 3 0.25', 'r 4 0.5', 'd 3 0.5', 'g 3 0.75', 'f 3 0.25', 'r 4 0.25', 'd 3 1.0', 'c 3 1.0', 'r 4 2.0', 'd 3 1.0', 'd 4 1.0', 'd 4 1.0', 'r 4 0.5', 'd 3 0.5', 'g 3 0.75', 'f 3 0.25', 'r 4 0.5', 'd 4 0.5', 'd 4 0.25', 'd 4 0.25', 'd 4 0.25'], ['d 5 1.5', 'r 4 0.5', 'g 4 0.5', 'f 4 0.25', 'r 4 0.75', 'f 4 0.25', 'f 4 0.25', 'f 4 0.5', 'f 4 0.5', 'f 4 0.25', 'f 4 0.25', 'f 4 0.5', 'f 4 0.5', 'd 4 0.5', 'd 4 0.5', 'c 4 0.25', 'a 3 0.25', 'r 4 0.5', 'c 4 0.25', 'r 4 1.0', 'p 1 1.0', 'r 4 1.0', 'p 1 1.0', 'r 4 1.0', ('c 4 0.75', 'f 4 0.75'), ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), 'r 4 2.0', 'r 4 0.5', ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), ('c 4 0.25', 'f 4 0.25'), 'r 4 1.0', 'p 1 0.25', 'r 4 0.5', ('b 4 0.5', 'f 5 0.5'), ('b 4 0.5', 'f 5 0.5'), ('b 4 0.5', 'f 5 0.5'), ('b 4 0.5', 'f 5 0.5'), ('b 4 0.5', 'f 5 0.5'), 'a 4 0.25', 'c 5 0.25', 'd 5 0.25', 'c 5 0.25', 'd 5 0.25', 'c 5 0.25', 'd 5 0.25', 'f 5 0.75', 'd 5 0.5', 'd 4 1.0', 'r 4 0.5', ('b 4 0.75', 'f 5 0.75'), ('b 4 0.25', 'f 5 0.25'), 'r 4 1.0', ('b 3 0.75', 'f 4 0.75'), ('b 3 0.25', 'f 4 0.25'), 'r 4 1.0', ('c 4 0.75', 'f 4 0.75'), ('c 4 0.25', 'f 4 0.25'), 'r 4 1.0', 'f 4 0.75', 'c 4 0.5', 'c 4 0.25', 'c 4 0.25', 'c 4 0.25', 'd 4 0.5', 'c 4 0.25', 'c 4 0.25', 'c 4 0.5', 'c 4 0.25', 'c 4 0.5', 'c 4 0.25', 'c 4 0.25', 'c 4 0.25', 'd 4 0.5', 'd 5 0.75', 'f 4 0.25'], ['r 4 0.5', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0', 'r 4 4.0']], 116)

#playMarkov(test[0],test[1])
